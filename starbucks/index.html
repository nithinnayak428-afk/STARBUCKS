<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Starbucks — Menu & Order (Demo)</title>

  <!-- icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    /* ---------- Global ---------- */
    * { box-sizing: border-box; margin:0; padding:0; font-family: "Helvetica Neue", Arial, sans-serif; }
    html,body { height:100%; }
    body { background:#fff; color:#111; font-size:15px; line-height:1.45; -webkit-font-smoothing:antialiased; }
    .container { max-width:1200px; margin:0 auto; padding:0 20px; }

    :root{
      --sb-green:#00704a;
      --sb-dark:#0b4d3a;
      --muted:#6d6d6d;
      --card-shadow: 0 6px 18px rgba(0,0,0,0.06);
      --glass: rgba(0,0,0,0.04);
    }

    a { color:inherit; text-decoration:none; }

    /* ---------- Top nav (Starbucks-like real style - Option A) ---------- */
    .topbar {
      position:fixed; left:0; right:0; top:0; height:76px;
      background:#f6fbf9; border-bottom:1px solid rgba(0,0,0,0.04);
      z-index:1100; display:flex; align-items:center; justify-content:center;
      box-shadow: 0 2px 8px rgba(0,0,0,0.03);
    }
    .topbar .inner { width:100%; max-width:1200px; display:flex; gap:18px; align-items:center; justify-content:space-between; padding:0 20px; }
    .brand { display:flex; gap:12px; align-items:center; }
    .brand img { height:46px; width:46px; object-fit:contain; display:block; }
    .brand-title { line-height:1; font-weight:700; color:var(--sb-dark); }
    .brand-sub { font-size:12px; color:var(--muted); }

    /* left nav items */
    .nav-links { display:flex; gap:18px; align-items:center; }
    .nav-links a { font-weight:700; letter-spacing:.06em; font-size:13px; color:var(--sb-dark); padding:10px 6px; position:relative; }
    .nav-links a:hover::after { width:100%; }
    .nav-links a::after { content:''; position:absolute; left:0; bottom:6px; height:2px; width:0; background:var(--sb-green); transition:width .18s ease; border-radius:2px; }

    /* right actions */
    .nav-actions { display:flex; gap:12px; align-items:center; }
    .btn { display:inline-flex; align-items:center; gap:8px; padding:8px 14px; border-radius:999px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; font-weight:700; }
    .btn.ghost { background:transparent; border:1px solid rgba(0,0,0,0.04); }
    .btn.primary { background:var(--sb-green); color:#fff; border:0; box-shadow: 0 6px 18px rgba(0,0,0,0.08); }
    .store-link { font-size:14px; color:var(--sb-dark); display:flex; gap:8px; align-items:center; }

    .cart-btn { position:relative; display:inline-flex; align-items:center; gap:8px; padding:8px 12px; border-radius:999px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; }
    .cart-count { position:absolute; top:-6px; right:-6px; background:var(--sb-green); color:#fff; width:20px; height:20px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-size:12px; font-weight:700; box-shadow:0 2px 6px rgba(0,0,0,0.12); }

    main { padding-top:98px; }

    /* ---------- Hero (subtle Starbucks feel) ---------- */
    .hero { background:#e5f2eb; padding:48px 20px 36px; border-bottom:1px solid rgba(0,0,0,0.02); text-align:center;}
    .hero h1 { color:var(--sb-dark); font-size:2.4rem; margin-bottom:8px; font-weight:800; letter-spacing:0.01em; }
    .hero p { color:var(--sb-dark); opacity:.9; font-size:1rem; }

    /* ---------- Products grid ---------- */
    .products { display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:26px; padding:28px 0; max-width:1200px; margin:0 auto; }
    .card { background:#fff; border-radius:12px; overflow:hidden; box-shadow:var(--card-shadow); transition:transform .18s; display:flex; flex-direction:column; }
    .card:hover{ transform: translateY(-6px); }
    .card img { width:100%; height:190px; object-fit:cover; display:block; }
    .card .body { padding:14px 16px; display:flex; flex-direction:column; gap:8px; flex:1; }
    .card h3 { color:var(--sb-dark); font-size:1.05rem; margin-bottom:2px; }
    .card p { color:var(--muted); font-size:13px; margin-bottom:6px; }
    .card .foot { padding:0 16px 16px; display:flex; justify-content:space-between; align-items:center; gap:10px; }
    .price { color:var(--sb-dark); font-weight:800; }

    /* ---------- Footer ---------- */
    .footer { background: #f0f6f4; color: var(--sb-dark); padding:36px 0 70px; margin-top:40px; }

    /* ---------- Modal & cart UI (kept from your working demo) ---------- */
    .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.45); display:none; align-items:center; justify-content:center; z-index:2000; padding:20px; }
    .overlay.show { display:flex; }
    .modal { background:#fff; border-radius:12px; max-width:920px; width:100%; box-shadow:0 12px 40px rgba(0,0,0,0.2); overflow:auto; max-height:90vh; padding:18px; position:relative; }
    .modal h3 { color:var(--sb-dark); margin-bottom:8px; }
    .close-x { position:absolute; right:12px; top:10px; background:transparent; border:none; font-size:20px; cursor:pointer; }

    .cart-grid { display:grid; grid-template-columns: 1fr 360px; gap:18px; align-items:start; }
    .cart-list { background:#fafafa; padding:12px; border-radius:8px; }
    .cart-item { display:flex; gap:12px; padding:8px; border-bottom:1px dashed rgba(0,0,0,0.06); align-items:center; }
    .cart-item img { width:88px; height:68px; object-fit:cover; border-radius:6px; }
    .qty-controls { display:flex; gap:8px; align-items:center; margin-top:6px; }
    .qty-controls button { width:32px; height:32px; border-radius:6px; border:1px solid rgba(0,0,0,0.06); background:#fff; cursor:pointer; }

    .checkout-box { background:#fff; border-radius:8px; padding:12px; border:1px solid rgba(0,0,0,0.04); }
    .checkout-row { display:flex; justify-content:space-between; margin-bottom:8px; align-items:center; }
    .total { font-weight:800; font-size:1.1rem; color:var(--sb-dark); }

    .payment-options { display:flex; gap:8px; margin-bottom:12px; flex-wrap:wrap; }
    .pay-pill { padding:8px 12px; border-radius:999px; border:1px solid rgba(0,0,0,0.06); cursor:pointer; }
    .pay-pill.active { background:var(--sb-green); color:#fff; border-color:var(--sb-green); }

    .history-list { display:flex; flex-direction:column; gap:10px; max-height:320px; overflow:auto; padding-right:6px; }
    .history-item { border-left:4px solid var(--sb-green); padding:8px; background:#f8fffb; border-radius:6px; display:flex; justify-content:space-between; align-items:center; gap:8px; }

    /* small screens */
    @media (max-width:980px) {
      .nav-links { display:none; } /* match compact real site behavior */
      .cart-grid { grid-template-columns: 1fr; }
      .modal { padding:14px; }
      .brand-title { display:none; } /* simplified on mobile */
    }
  </style>
</head>

<body>
  <!-- TOP NAV (Starbucks-like: MENU, REWARDS, GIFT CARDS, Find a store, Sign in, Join now) -->
  <header class="topbar" role="banner">
    <div class="inner container" role="navigation" aria-label="Main navigation">
      <div style="display:flex;align-items:center;gap:18px;">
        <a href="#top" class="brand" aria-label="Starbucks Home">
          <img src="https://upload.wikimedia.org/wikipedia/en/thumb/d/d3/Starbucks_Corporation_Logo_2011.svg/1200px-Starbucks_Corporation_Logo_2011.svg.png" alt="Starbucks logo">
          <div>
            <div class="brand-title">Starbucks</div>
            <div class="brand-sub">Coffee & Beverages</div>
          </div>
        </a>

        <nav class="nav-links" aria-label="Primary">
          <a href="#products">Menu</a>
          <a href="#" id="rewards-link">Rewards</a>
          <a href="#" id="giftcards-link">Gift Cards</a>
        </nav>
      </div>

      <div class="nav-actions" role="group" aria-label="User actions">
        <a href="#" class="store-link" id="find-store-link"><i class="fas fa-map-marker-alt"></i> Find a store</a>
        <button class="btn ghost" id="sign-in-link">Sign in</button>
        <button class="btn primary" id="join-now-link">Join now</button>

        <button class="cart-btn" id="open-cart" aria-haspopup="dialog" aria-controls="cart-modal" title="Open cart">
          <i class="fas fa-shopping-cart"></i>
          <span class="muted" style="font-weight:800;">Cart</span>
          <span class="cart-count" id="cart-count" aria-live="polite">0</span>
        </button>
      </div>
    </div>
  </header>

  <main id="top">
    <section class="hero">
      <div class="container">
        <h1>Summer is brighter with free treats*</h1>
        <p>Join Starbucks® Rewards for delicious deals & exclusive offers. (Demo site — orders are simulated.)</p>
      </div>
    </section>

    <!-- PRODUCTS GRID -->
    <section id="products" class="products container" aria-label="Products">
      <!-- JS injected product cards -->
    </section>

    <section class="container" style="padding:28px 0;">
      <h2 style="color:var(--sb-dark)">More to explore</h2>
      <p style="color:var(--muted)">Seasonal drinks, member perks & pickup options.</p>
    </section>
  </main>

  <footer class="footer" role="contentinfo">
    <div class="container">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
          <h4 style="margin-bottom:6px;">Starbucks</h4>
          <p style="margin:0;color:var(--muted)">This is a frontend-only demo. No real payments are processed.</p>
        </div>
        <div><small style="color:var(--muted)">&copy; 2025 Starbucks Demo</small></div>
      </div>
    </div>
  </footer>

  <!-- CART MODAL (keeps ordering/cart logic) -->
  <div id="cart-modal" class="overlay" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal" role="document" aria-labelledby="cart-title">
      <button class="close-x" id="close-cart" aria-label="Close">&times;</button>
      <h3 id="cart-title">Your Cart</h3>

      <div class="cart-grid" id="cart-grid">
        <div>
          <div class="cart-list" id="cart-items">
            <div class="muted" id="empty-cart-msg" style="padding:12px;">Your cart is empty — add items to proceed.</div>
          </div>
        </div>

        <aside>
          <div class="checkout-box">
            <div class="checkout-row"><div class="muted">Subtotal</div><div id="subtotal-text">₹0</div></div>
            <div class="checkout-row"><div class="muted">Delivery</div><div id="delivery-text">₹30</div></div>
            <div class="checkout-row" style="border-top:1px dashed rgba(0,0,0,0.06); padding-top:8px;">
              <div class="muted">Total</div>
              <div class="total" id="total-text">₹0</div>
            </div>

            <hr style="margin:10px 0 12px; border:none; border-top:1px solid rgba(0,0,0,0.04);" />

            <div style="margin-bottom:10px;">
              <div class="muted">Payment method</div>
              <div class="payment-options" id="payment-options">
                <div class="pay-pill active" data-method="card">Card</div>
                <div class="pay-pill" data-method="upi">UPI</div>
                <div class="pay-pill" data-method="cod">Cash on Delivery</div>
              </div>
            </div>

            <button class="btn primary" id="checkout-btn" aria-disabled="true">Checkout</button>
            <div style="margin-top:8px;"><small class="muted">Orders earn demo rewards points on delivery.</small></div>
          </div>

          <div style="margin-top:12px;">
            <h4 style="margin:6px 0;">Order History</h4>
            <div class="history-list" id="order-history"><div class="muted" id="no-history">No past orders yet.</div></div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- PAYMENT MODAL -->
  <div id="payment-modal" class="overlay" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal" role="document" aria-labelledby="pay-title">
      <button class="close-x" id="close-payment" aria-label="Close">&times;</button>
      <h3 id="pay-title">Confirm & Pay</h3>
      <div id="payment-body"></div>
    </div>
  </div>

  <!-- STATUS MODAL -->
  <div id="status-modal" class="overlay" role="dialog" aria-modal="true" aria-hidden="true" tabindex="-1">
    <div class="modal" role="document" aria-labelledby="status-title">
      <button class="close-x" id="close-status" aria-label="Close">&times;</button>
      <h3 id="status-title">Order Status</h3>
      <div id="status-body"></div>
    </div>
  </div>

  <!-- SIMPLE MODAL (receipts / quick views / small informational modals) -->
  <div id="simple-overlay" class="overlay" role="dialog" aria-modal="true" tabindex="-1">
    <div class="modal" id="simple-modal" role="document">
      <button class="close-x" id="simple-close" aria-label="Close">&times;</button>
      <div id="simple-content"></div>
    </div>
  </div>

  <script>
    (function(){
      // ---------- products (same as before) ----------
      const PRODUCTS = [
        { id: 'iced-coffee', title: 'Iced Coffee', price: 140, desc: 'Perfectly refreshing and deliciously cool.', img: 'https://media-assets.swiggy.com/swiggy/image/upload/fl_lossy,f_auto,q_auto,w_400/RX_THUMBNAIL/IMAGES/VENDOR/2025/3/17/2e2d52fe-3b10-4f44-8472-06506806e4da_762592.JPG' },
        { id: 'frappuccino', title: 'Frappuccino', price: 220, desc: 'Blended to perfection.', img: 'https://bigcupofcoffee.com/wp-content/uploads/2022/12/Java-Chip-Frappacino-Featured-2.jpg.webp' },
        { id: 'cold-brew', title: 'Cold Brew', price: 160, desc: 'Smooth and bold.', img: 'https://res.cloudinary.com/jerrick/image/upload/v1505219126/aofunlrqahqmn07shs5s.jpg' },
        { id: 'hot-coffee', title: 'Hot Coffee', price: 130, desc: 'Freshly brewed and rich in flavor.', img: 'https://cloudassets.starbucks.com/is/image/sbuxcorp/CaffeAmericano?impolicy=1by1_tight_288&crop=495,495,810,810&wid=288&hei=288&qlt=85' },
        { id: 'matcha-latte', title: 'Matcha Latte', price: 210, desc: 'Smooth, creamy and earthy matcha blend.', img: 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmx1k3TEFZqTmRTM5Bdoe7lWW9mFeJcVTKcQ&s' },
        { id: 'mocha', title: 'Mocha', price: 200, desc: 'Espresso with rich chocolate and steamed milk.', img: 'https://athome.starbucks.com/sites/default/files/styles/recipe_banner_xlarge/public/2024-05/CaffeMocha_RecipeHeader_848x539_%402x.jpg.webp?itok=ov3gQo8W' },
        { id: 'strawberry-acai', title: 'Strawberry Açaí', price: 180, desc: 'Refreshing, fruity and lightly sweet.', img: 'https://www.windingcreekranch.org/wp-content/uploads/2023/07/starbucks-copycat-strawberry-acai-lemonade-refresher-recipe-in-glass-1-of-1.jpg' },
        { id: 'caramel-frapp', title: 'Caramel Frappuccino', price: 240, desc: 'Sweet, creamy and blended perfectly.', img: 'https://www.bbassets.com/media/uploads/p/xl/40337953_3-starbucks-coffee-caramel-frappuccino-tall.jpg' }
      ];

      const KEY_CART = 'demo_cart_v1';
      const KEY_ORDERS = 'demo_orders_v1';
      const KEY_REWARDS = 'demo_rewards_v1';
      const DELIVERY_FEE = 30;

      // IMPORTANT: local path to the user's uploaded receipt image
      // (developer provided path from conversation history)
      const LOCAL_RECEIPT_IMAGE = '/mnt/data/17e38bd4-00c3-41cb-af12-e87bfc5baa1d.png'; // <- updated path (use your uploaded file)
      // Note: if your exact filename differs, replace with the exact path shown in your environment.
      const EXTRA_RECEIPTS = [
        'https://via.placeholder.com/400x240.png?text=Receipt+Example+1',
        'https://via.placeholder.com/400x240.png?text=Receipt+Example+2'
      ];
      const RECEIPT_URLS = [LOCAL_RECEIPT_IMAGE, ...EXTRA_RECEIPTS];

      // helpers
      const $ = s => document.querySelector(s);
      const $$ = s => Array.from(document.querySelectorAll(s));
      const money = n => '₹' + Number(n).toFixed(0);
      const uid = (p='o') => p + '-' + Math.random().toString(36).slice(2,10);
      const load = (k, fallback) => { try { const v = JSON.parse(localStorage.getItem(k)); return v === null ? fallback : v; } catch(e){ return fallback; } };
      const saveJSON = (k, v) => localStorage.setItem(k, JSON.stringify(v));

      // state
      let cart = load(KEY_CART, []);
      let orders = load(KEY_ORDERS, []);
      let rewards = Number(localStorage.getItem(KEY_REWARDS) || 0);
      let selectedPayment = 'card';
      let signedInUser = null; // demo sign-in state

      // refs
      const productsEl = $('#products');
      const cartCountEl = $('#cart-count');
      const openCartBtn = $('#open-cart');
      const cartModal = $('#cart-modal');
      const closeCartBtn = $('#close-cart');
      const cartItemsEl = $('#cart-items');
      const emptyCartMsg = $('#empty-cart-msg');
      const subtotalText = $('#subtotal-text');
      const deliveryText = $('#delivery-text');
      const totalText = $('#total-text');
      const paymentOptions = $('#payment-options');
      const checkoutBtn = $('#checkout-btn');
      const orderHistoryEl = $('#order-history');
      const noHistoryEl = $('#no-history');

      const paymentModal = $('#payment-modal');
      const paymentBody = $('#payment-body');
      const closePaymentBtn = $('#close-payment');

      const statusModal = $('#status-modal');
      const statusBody = $('#status-body');
      const closeStatusBtn = $('#close-status');

      const simpleOverlay = $('#simple-overlay');
      const simpleContent = $('#simple-content');
      const simpleClose = $('#simple-close');

      // ---------- render products (like real site cards) ----------
      function renderProducts(){
        productsEl.innerHTML = '';
        PRODUCTS.forEach(p => {
          const el = document.createElement('article');
          el.className = 'card';
          el.innerHTML = `
            <img src="${p.img}" alt="${p.title}" loading="lazy">
            <div class="body">
              <div>
                <h3>${p.title}</h3>
                <p>${p.desc}</p>
              </div>
            </div>
            <div class="foot">
              <div class="price">${money(p.price)}</div>
              <div style="display:flex; gap:8px;">
                <button class="btn" data-id="${p.id}" aria-label="Details ${p.title}">Details</button>
                <button class="btn primary add-to-cart" data-id="${p.id}" aria-label="Add ${p.title}">Add</button>
              </div>
            </div>
          `;
          productsEl.appendChild(el);
        });

        $$('.add-to-cart').forEach(btn => btn.addEventListener('click', e => { addToCart(btn.dataset.id, 1); openCart(); }));

        $$('.card .btn:not(.add-to-cart)').forEach(btn => {
          btn.addEventListener('click', e => {
            const id = btn.dataset.id;
            const p = PRODUCTS.find(x => x.id === id);
            openSimpleModal(p.title, `
              <div style="display:flex; gap:12px; align-items:flex-start;">
                <img src="${p.img}" alt="${p.title}" style="width:160px;height:120px;object-fit:cover;border-radius:8px;">
                <div>
                  <p style="font-weight:800;margin:0 0 8px;">${p.title} — ${money(p.price)}</p>
                  <p class="muted" style="margin:0 0 10px;">${p.desc}</p>
                  <div style="display:flex; gap:8px;">
                    <button class="btn primary" id="detail-add" data-id="${p.id}">Add to cart</button>
                    <button class="btn" id="detail-close">Close</button>
                  </div>
                </div>
              </div>
            `);
            setTimeout(()=> {
              document.getElementById('detail-add').addEventListener('click', ()=> { addToCart(id,1); closeSimpleModal(); openCart(); });
              document.getElementById('detail-close').addEventListener('click', closeSimpleModal);
            },50);
          });
        });
      }

      // ---------- cart operations ----------
      function saveCart(){ saveJSON(KEY_CART, cart); }
      function saveOrders(){ saveJSON(KEY_ORDERS, orders); }
      function saveRewards(v){ localStorage.setItem(KEY_REWARDS, String(v)); }

      function addToCart(id, qty=1){
        const found = cart.find(i=>i.id===id);
        if(found) found.qty += qty; else cart.push({ id, qty });
        saveCart(); renderCart();
      }
      function setQty(id, qty){
        if(qty<=0) cart = cart.filter(x=>x.id!==id); else { const it = cart.find(x=>x.id===id); if(it) it.qty = qty; }
        saveCart(); renderCart();
      }
      function removeFromCart(id){ cart = cart.filter(x=>x.id!==id); saveCart(); renderCart(); }
      function clearCart(){ cart = []; saveCart(); renderCart(); }

      function cartSummary(){
        let subtotal = 0;
        cart.forEach(ci => { const p = PRODUCTS.find(x => x.id === ci.id); if(p) subtotal += p.price * ci.qty; });
        const delivery = cart.length ? DELIVERY_FEE : 0;
        return { subtotal, delivery, total: subtotal + delivery };
      }

      function renderCart(){
        const totalItems = cart.reduce((s,i)=>s+i.qty,0);
        cartCountEl.textContent = totalItems;
        cartCountEl.setAttribute('aria-label', totalItems + ' items in cart');

        cartItemsEl.innerHTML = '';
        if(cart.length===0){
          emptyCartMsg.style.display = 'block';
        } else {
          emptyCartMsg.style.display = 'none';
          cart.forEach(ci => {
            const p = PRODUCTS.find(x=>x.id===ci.id);
            const div = document.createElement('div');
            div.className = 'cart-item';
            div.innerHTML = `
              <img src="${p.img}" alt="${p.title}">
              <div style="flex:1;">
                <h4 style="margin:0 0 6px;">${p.title}</h4>
                <div style="color:var(--muted)">${money(p.price)} × <strong>${ci.qty}</strong></div>
                <div class="qty-controls">
                  <button class="btn" data-action="dec" data-id="${ci.id}">-</button>
                  <div style="min-width:28px; text-align:center;">${ci.qty}</div>
                  <button class="btn" data-action="inc" data-id="${ci.id}">+</button>
                  <button class="btn" data-action="remove" data-id="${ci.id}" style="margin-left:8px;">Remove</button>
                </div>
              </div>
            `;
            cartItemsEl.appendChild(div);
          });

          cartItemsEl.querySelectorAll('[data-action]').forEach(btn=>{
            btn.addEventListener('click', ()=> {
              const id = btn.dataset.id, action = btn.dataset.action;
              const it = cart.find(x=>x.id===id); if(!it) return;
              if(action==='inc') setQty(id, it.qty+1);
              if(action==='dec') setQty(id, Math.max(0, it.qty-1));
              if(action==='remove') removeFromCart(id);
            });
          });
        }

        const sums = cartSummary();
        subtotalText.textContent = money(sums.subtotal);
        deliveryText.textContent = cart.length ? money(sums.delivery) : money(0);
        totalText.textContent = money(sums.total);

        if(cart.length>0){ checkoutBtn.removeAttribute('aria-disabled'); checkoutBtn.disabled=false; } else { checkoutBtn.setAttribute('aria-disabled','true'); checkoutBtn.disabled=true; }

        renderOrderHistory();
      }

      // ---------- modals ----------
      function openCart(){ cartModal.classList.add('show'); cartModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden'; setTimeout(()=>checkoutBtn.focus(),60); }
      function closeCart(){ cartModal.classList.remove('show'); cartModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
      openCartBtn.addEventListener('click', openCart);
      closeCartBtn.addEventListener('click', closeCart);
      cartModal.addEventListener('click', e => { if(e.target===cartModal) closeCart(); });

      paymentOptions.addEventListener('click', (e) => {
        const pill = e.target.closest('.pay-pill'); if(!pill) return;
        paymentOptions.querySelectorAll('.pay-pill').forEach(x=>x.classList.remove('active'));
        pill.classList.add('active'); selectedPayment = pill.dataset.method;
      });

      checkoutBtn.addEventListener('click', e => { e.preventDefault(); openPaymentModal(); });

      // ---------- payment modal ----------
      function openPaymentModal(){
        const sums = cartSummary();
        const itemsHtml = cart.map(ci => {
          const p = PRODUCTS.find(x=>x.id===ci.id);
          return `<div style="display:flex; gap:10px; align-items:center; margin-bottom:8px;">
            <img src="${p.img}" alt="${p.title}" style="width:78px;height:56px;object-fit:cover;border-radius:6px;">
            <div style="flex:1;">
              <strong>${p.title}</strong>
              <div class="muted">${ci.qty} × ${money(p.price)}</div>
            </div>
            <div style="font-weight:800;">${money(p.price*ci.qty)}</div>
          </div>`;
        }).join('');

        paymentBody.innerHTML = `
          <div style="display:flex; flex-direction:column; gap:12px;">
            <div>${itemsHtml}</div>
            <div style="border-top:1px dashed rgba(0,0,0,0.06); padding-top:8px;">
              <div style="display:flex; justify-content:space-between;"><div class="muted">Subtotal</div><div>${money(sums.subtotal)}</div></div>
              <div style="display:flex; justify-content:space-between;"><div class="muted">Delivery</div><div>${money(sums.delivery)}</div></div>
              <div style="display:flex; justify-content:space-between; font-weight:800; margin-top:6px;"><div>Total</div><div>${money(sums.total)}</div></div>
            </div>

            <div>
              <div class="muted">Choose payment</div>
              <div style="display:flex; gap:8px; margin-top:8px;">
                <label><input type="radio" name="paymethod" value="card" ${selectedPayment==='card'?'checked':''}> Card</label>
                <label><input type="radio" name="paymethod" value="upi" ${selectedPayment==='upi'?'checked':''}> UPI</label>
                <label><input type="radio" name="paymethod" value="cod" ${selectedPayment==='cod'?'checked':''}> COD</label>
              </div>
            </div>

            <div id="payment-form-area"></div>

            <div style="display:flex; gap:8px; justify-content:flex-end;">
              <button class="btn" id="pay-cancel">Cancel</button>
              <button class="btn primary" id="pay-confirm">Pay ${money(sums.total)}</button>
            </div>
          </div>
        `;
        paymentModal.classList.add('show'); paymentModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';

        paymentBody.querySelectorAll('input[name="paymethod"]').forEach(r => r.addEventListener('change', ev => { selectedPayment = ev.target.value; renderPaymentForm(); }));
        document.getElementById('pay-cancel').addEventListener('click', closePaymentModal);
        document.getElementById('pay-confirm').addEventListener('click', doPayment);

        renderPaymentForm();
      }

      function renderPaymentForm(){
        const area = document.getElementById('payment-form-area');
        if(!area) return;
        if(selectedPayment === 'card'){
          area.innerHTML = `<div style="display:flex; gap:8px; margin-top:10px;">
            <input placeholder="Card number (4242...)" id="cardno" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ddd;">
            <input placeholder="MM/YY" id="cardexp" style="width:86px; padding:8px; border-radius:6px; border:1px solid #ddd;">
            <input placeholder="CVC" id="cardcvc" style="width:80px; padding:8px; border-radius:6px; border:1px solid #ddd;">
          </div>`;
        } else if(selectedPayment === 'upi'){
          area.innerHTML = `<div style="margin-top:10px;">
            <input id="upi-id" placeholder="your@upi" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ddd;">
            <div class="muted" style="margin-top:6px;">You'll confirm payment in your UPI app (demo).</div>
          </div>`;
        } else {
          area.innerHTML = `<div style="margin-top:10px;"><div class="muted">You will pay on delivery (COD).</div></div>`;
        }
      }

      function closePaymentModal(){ paymentModal.classList.remove('show'); paymentModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
      closePaymentBtn.addEventListener('click', closePaymentModal);
      paymentModal.addEventListener('click', e => { if(e.target === paymentModal) closePaymentModal(); });

      // ---------- process payment & create order ----------
      function doPayment(){
        if(selectedPayment === 'card'){
          const cardno = document.getElementById('cardno').value.trim();
          const cvc = document.getElementById('cardcvc').value.trim();
          if(!cardno || cardno.length < 12){ alert('Enter a valid card number (demo)'); return; }
          if(!cvc || cvc.length < 3){ alert('Enter CVC (demo)'); return; }
        }
        if(selectedPayment === 'upi'){
          const upi = document.getElementById('upi-id').value.trim();
          if(!upi || !upi.includes('@')){ alert('Enter a valid UPI id (demo)'); return; }
        }

        const payBtn = document.getElementById('pay-confirm');
        payBtn.disabled = true; payBtn.textContent = 'Processing...';

        setTimeout(()=>{
          let paymentStatus = 'succeeded';
          if(selectedPayment === 'cod') paymentStatus = 'pending';
          else paymentStatus = Math.random() < 0.92 ? 'succeeded' : 'failed';

          const sums = cartSummary();
          const orderId = uid('ORD');
          const order = {
            id: orderId,
            createdAt: Date.now(),
            items: cart.map(ci => ({ ...ci })),
            paymentMethod: selectedPayment,
            paymentStatus,
            orderStatus: paymentStatus === 'succeeded' ? 'accepted' : 'failed',
            subtotal: sums.subtotal,
            delivery: sums.delivery,
            total: sums.total
          };

          orders.unshift(order); saveOrders();
          if(paymentStatus === 'succeeded' || selectedPayment === 'cod') clearCart();

          closePaymentModal();
          openStatusModal(order);

          if((paymentStatus === 'succeeded') || (selectedPayment === 'cod')){
            if(order.orderStatus !== 'failed') startOrderProgress(order.id);
          }
          renderOrderHistory();
        }, 800 + Math.random()*900);
      }

      // ---------- status modal ----------
      function openStatusModal(order){
        statusBody.innerHTML = buildOrderDetailHtml(order);
        statusModal.classList.add('show'); statusModal.setAttribute('aria-hidden','false'); document.body.style.overflow='hidden';
      }
      function closeStatusModal(){ statusModal.classList.remove('show'); statusModal.setAttribute('aria-hidden','true'); document.body.style.overflow=''; }
      closeStatusBtn.addEventListener('click', closeStatusModal);
      statusModal.addEventListener('click', e => { if(e.target === statusModal) closeStatusModal(); });

      function buildOrderDetailHtml(order){
        const itemsHtml = order.items.map(ci => {
          const p = PRODUCTS.find(x => x.id === ci.id);
          return `<div style="display:flex; gap:12px; align-items:center; padding:8px 0;">
            <img src="${p.img}" alt="${p.title}" style="width:90px;height:64px;object-fit:cover;border-radius:6px;">
            <div style="flex:1;">
              <div style="font-weight:800; color:var(--sb-dark);">${p.title}</div>
              <div class="muted">${ci.qty} × ${money(p.price)}</div>
            </div>
            <div style="font-weight:800;">${money(p.price*ci.qty)}</div>
          </div>`;
        }).join('');

        const payLabel = order.paymentStatus === 'succeeded' ? '<strong style="color:green">Payment: Completed</strong>' : (order.paymentStatus === 'pending' ? '<strong style="color:orange">Payment: Pending</strong>' : '<strong style="color:red">Payment: Failed</strong>');

        const html = `
          <div style="margin-top:8px;">
            <div style="display:flex; justify-content:space-between; gap:12px; margin-bottom:8px;">
              <div><strong>Order ID:</strong> ${order.id}</div>
              <div><strong>Placed:</strong> ${new Date(order.createdAt).toLocaleString()}</div>
            </div>

            <div style="margin-bottom:8px;">${itemsHtml}</div>

            <div style="border-top:1px solid rgba(0,0,0,0.05); padding-top:10px; margin-bottom:8px;">
              <div style="display:flex; justify-content:space-between;"><div class="muted">Subtotal</div><div>${money(order.subtotal)}</div></div>
              <div style="display:flex; justify-content:space-between;"><div class="muted">Delivery</div><div>${money(order.delivery)}</div></div>
              <div style="display:flex; justify-content:space-between; font-weight:800; margin-top:6px;"><div>Total</div><div>${money(order.total)}</div></div>
            </div>

            <div style="margin-bottom:8px;">${payLabel}</div>

            <div id="progress-block-${order.id}" style="margin-bottom:12px;">${renderProgressHtml(order.orderStatus)}</div>

            <div style="display:flex; gap:8px; justify-content:flex-end;">
              <button class="btn" id="view-receipt" data-order="${order.id}">View Receipt</button>
              <button class="btn primary" id="close-status-btn">Close</button>
            </div>
          </div>
        `;
        return html;
      }

      function renderProgressHtml(status){
        const steps = ['accepted','preparing','out-for-delivery','delivered'];
        const labels = ['Accepted','Preparing','Out for Delivery','Delivered'];
        let html = '<div style="display:flex; gap:8px; align-items:center;">';
        steps.forEach((s,i) => {
          const active = steps.indexOf(status) >= i;
          html += `<div style="flex:1; text-align:center;">
            <div style="width:36px;height:36px;border-radius:50%; display:inline-flex; align-items:center; justify-content:center; ${active ? 'background:var(--sb-green); color:#fff; font-weight:800;' : 'background:#f1f1f1; color:#777;'}">${i+1}</div>
            <div style="margin-top:6px; font-size:13px; color:${active ? 'var(--sb-dark)' : '#888'}">${labels[i]}</div>
          </div>`;
        });
        html += '</div>';
        return html;
      }

      // ---------- simulate progress ----------
      const progressIntervals = {};
      function startOrderProgress(orderId){
        const idx = orders.findIndex(o => o.id === orderId);
        if(idx === -1) return;
        if(orders[idx].orderStatus === 'delivered' || orders[idx].orderStatus === 'failed') return;

        const seq = ['accepted','preparing','out-for-delivery','delivered'];
        let curIndex = Math.max(0, seq.indexOf(orders[idx].orderStatus));
        if(curIndex === -1) curIndex = 0;

        const step = () => {
          if(!orders[idx]) return;
          if(orders[idx].orderStatus === 'delivered' || orders[idx].orderStatus === 'failed'){
            clearInterval(progressIntervals[orderId]); delete progressIntervals[orderId]; return;
          }
          curIndex = Math.min(seq.length-1, curIndex+1);
          orders[idx].orderStatus = seq[curIndex];
          saveOrders();
          renderOrderHistory();

          const progressBlock = document.getElementById('progress-block-' + orderId);
          if(progressBlock) progressBlock.innerHTML = renderProgressHtml(orders[idx].orderStatus);

          if(orders[idx].orderStatus === 'delivered'){
            rewards += Math.round(orders[idx].total / 50);
            saveRewards(rewards);
            updateRewardsUI();
          }
        };

        setTimeout(step, 1200);
        const iv = setInterval(step, 4200 + Math.random()*1800);
        progressIntervals[orderId] = iv;
      }

      // ---------- order history ----------
      function renderOrderHistory(){
        const hist = orders.slice(0,8);
        orderHistoryEl.innerHTML = '';
        if(!hist || hist.length === 0){ noHistoryEl.style.display = 'block'; return; } else { noHistoryEl.style.display = 'none'; }
        hist.forEach(o => {
          const el = document.createElement('div');
          el.className = 'history-item';
          el.innerHTML = `
            <div>
              <div style="font-weight:800;">${o.id}</div>
              <div class="muted">${new Date(o.createdAt).toLocaleString()}</div>
              <div style="margin-top:6px;" class="muted">Status: <strong>${o.orderStatus}</strong></div>
            </div>
            <div style="text-align:right;">
              <div style="font-weight:800;">${money(o.total)}</div>
              <div style="margin-top:8px;"><button class="btn" data-order="${o.id}" data-action="view">View</button></div>
            </div>
          `;
          orderHistoryEl.appendChild(el);
        });

        orderHistoryEl.querySelectorAll('[data-action="view"]').forEach(btn => btn.addEventListener('click', () => {
          const id = btn.dataset.order; const ord = orders.find(x=>x.id===id); if(ord) openStatusModal(ord);
        }));
      }

      // ---------- simple modal for receipts & details ----------
      function openSimpleModal(title, html){
        simpleContent.innerHTML = `<h3>${title}</h3>` + html;
        simpleOverlay.style.display = 'flex'; simpleOverlay.classList.add('show');
        document.body.style.overflow = 'hidden';
      }
      function closeSimpleModal(){ simpleOverlay.style.display = 'none'; simpleOverlay.classList.remove('show'); document.body.style.overflow = ''; }
      simpleClose.addEventListener('click', closeSimpleModal);
      simpleOverlay.addEventListener('click', e => { if(e.target === simpleOverlay) closeSimpleModal(); });

      // ---------- receipts: allow random selection and include uploaded local file ----------
      function openReceiptModal(order){
        const optionsHtml = RECEIPT_URLS.map((u,i) => `<option value="${u}">${i === 0 ? 'Uploaded (local)' : 'Sample ' + i}</option>`).join('');
        const itemsHtml = order.items.map(ci => {
          const p = PRODUCTS.find(x=>x.id===ci.id);
          return `<div style="display:flex; justify-content:space-between; margin-bottom:4px;"><div>${p.title} × ${ci.qty}</div><div>${money(p.price*ci.qty)}</div></div>`;
        }).join('');
        const html = `
          <div style="display:flex; gap:12px; align-items:flex-start;">
            <div style="flex:1;">
              <div style="font-weight:800; margin-bottom:6px;">Receipt — ${order.id}</div>
              <div class="muted" style="margin-bottom:8px;">${new Date(order.createdAt).toLocaleString()}</div>
              ${itemsHtml}
              <div style="border-top:1px dashed rgba(0,0,0,0.06); margin-top:6px; padding-top:6px;">
                <div style="display:flex; justify-content:space-between;"><div class="muted">Subtotal</div><div>${money(order.subtotal)}</div></div>
                <div style="display:flex; justify-content:space-between;"><div class="muted">Delivery</div><div>${money(order.delivery)}</div></div>
                <div style="display:flex; justify-content:space-between; font-weight:800; margin-top:6px;"><div>Total</div><div>${money(order.total)}</div></div>
              </div>
            </div>

            <div style="width:320px;">
              <label class="muted" style="display:block; margin-bottom:6px;">Choose receipt image</label>
              <select id="receipt-select" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ddd; margin-bottom:8px;">
                ${optionsHtml}
              </select>
              <div style="display:flex; gap:8px; margin-bottom:8px;">
                <button class="btn" id="receipt-random">Random</button>
                <button class="btn" id="receipt-open-new">Open image</button>
              </div>
              <div style="border:1px solid rgba(0,0,0,0.06); padding:8px; border-radius:6px; text-align:center;">
                <img id="receipt-img" src="${RECEIPT_URLS[0]}" alt="receipt" style="width:100%; height:180px; object-fit:cover; border-radius:6px;">
                <div class="muted" style="margin-top:8px; font-size:12px;">Local uploaded file is first option (demo).</div>
              </div>
              <div style="margin-top:8px; text-align:right;">
                <button class="btn primary" id="receipt-done">Done</button>
              </div>
            </div>
          </div>
        `;
        openSimpleModal('Receipt', html);

        setTimeout(()=> {
          const select = document.getElementById('receipt-select');
          const img = document.getElementById('receipt-img');
          const btnRand = document.getElementById('receipt-random');
          const btnOpen = document.getElementById('receipt-open-new');
          const btnDone = document.getElementById('receipt-done');

          select.addEventListener('change', ()=> { img.src = select.value; });
          btnRand.addEventListener('click', ()=> { const idx = Math.floor(Math.random()*RECEIPT_URLS.length); select.selectedIndex = idx; img.src = RECEIPT_URLS[idx]; });
          btnOpen.addEventListener('click', ()=> { window.open(select.value, '_blank'); });
          btnDone.addEventListener('click', closeSimpleModal);
        }, 60);
      }

      // delegation for View Receipt button in status modal
      document.addEventListener('click', (e) => {
        if(e.target && e.target.id === 'view-receipt'){
          const orderId = e.target.dataset.order || null;
          const ord = orders.find(x=>x.id===orderId) || orders[0];
          if(ord) openReceiptModal(ord);
        }
        if(e.target && e.target.id === 'close-status-btn') closeStatusModal();
      });

      // ---------- rewards UI ----------
      function updateRewardsUI(){ /* placeholder: you can add a visible rewards UI later */ }

      // ---------- header button handlers: make the nav items actually *work* ----------
      function setupHeaderHandlers(){
        // Rewards
        const rewardsLink = document.getElementById('rewards-link');
        if(rewardsLink){
          rewardsLink.addEventListener('click', (e) => {
            e.preventDefault();
            const html = `
              <div>
                <p style="margin:6px 0 12px;">Join our demo rewards for sample offers. Earn points on delivered orders and redeem for demo treats.</p>
                <div style="display:flex; gap:8px;">
                  <button class="btn primary" id="rewards-join">Join rewards</button>
                  <button class="btn" id="rewards-learn">Learn more</button>
                </div>
              </div>
            `;
            openSimpleModal('Rewards', html);
            setTimeout(()=>{
              document.getElementById('rewards-join').addEventListener('click', ()=> {
                closeSimpleModal();
                openSimpleModal('Joined — Demo Rewards', `<p style="margin:8px 0;">You're now a member of the demo rewards program (frontend only). You will earn sample points when orders are delivered.</p><div style="text-align:right;"><button class="btn primary" id="rewards-ok">OK</button></div>`);
                setTimeout(()=>{ document.getElementById('rewards-ok').addEventListener('click', closeSimpleModal); },50);
              });
              document.getElementById('rewards-learn').addEventListener('click', ()=> {
                closeSimpleModal();
                openSimpleModal('Rewards — How it works', `<p class="muted">Demo only: points are awarded when orders reach 'delivered' status. Points are stored in localStorage for this demo.</p><div style="text-align:right;"><button class="btn" id="rewards-close">Close</button></div>`);
                setTimeout(()=>{ document.getElementById('rewards-close').addEventListener('click', closeSimpleModal); },50);
              });
            },50);
          });
        }

        // Gift cards
        const giftcardsLink = document.getElementById('giftcards-link');
        if(giftcardsLink){
          giftcardsLink.addEventListener('click', (e) => {
            e.preventDefault();
            const html = `
              <div style="display:flex; gap:12px; flex-wrap:wrap;">
                <div style="flex:1; min-width:200px;">
                  <img src="https://via.placeholder.com/320x180.png?text=Gift+Card+₹500" style="width:100%; border-radius:8px; object-fit:cover;">
                  <div style="margin-top:8px;"><strong>Gift Card — ₹500</strong></div>
                  <div class="muted" style="margin-top:6px;">A demo gift card. No payment is processed.</div>
                  <div style="margin-top:8px;"><button class="btn primary" id="gift-add-500">Add sample gift card</button></div>
                </div>

                <div style="flex:1; min-width:200px;">
                  <img src="https://via.placeholder.com/320x180.png?text=Gift+Card+₹1000" style="width:100%; border-radius:8px; object-fit:cover;">
                  <div style="margin-top:8px;"><strong>Gift Card — ₹1000</strong></div>
                  <div class="muted" style="margin-top:6px;">Add to cart as a demo item.</div>
                  <div style="margin-top:8px;"><button class="btn primary" id="gift-add-1000">Add sample gift card</button></div>
                </div>
              </div>
            `;
            openSimpleModal('Gift Cards', html);
            setTimeout(()=>{
              document.getElementById('gift-add-500').addEventListener('click', ()=> { addToCart('gift-500',1); closeSimpleModal(); openCart(); });
              document.getElementById('gift-add-1000').addEventListener('click', ()=> { addToCart('gift-1000',1); closeSimpleModal(); openCart(); });
            },50);
          });
        }

        // Find a store
        const findStore = document.getElementById('find-store-link');
        if(findStore){
          findStore.addEventListener('click', (e) => {
            e.preventDefault();
            const html = `
              <div>
                <p class="muted" style="margin-bottom:12px;">This demo does not access geolocation. Below is a sample store location.</p>
                <div style="border:1px solid #eee; padding:12px; border-radius:8px;">
                  <strong>Starbucks Sample Store</strong>
                  <div class="muted">MG Road, Demo City</div>
                  <div style="margin-top:8px;"><button class="btn" id="store-directions">Get directions (demo)</button></div>
                </div>
              </div>
            `;
            openSimpleModal('Find a store', html);
            setTimeout(()=> {
              document.getElementById('store-directions').addEventListener('click', ()=> { window.open('https://www.google.com/maps', '_blank'); });
            },50);
          });
        }

        // Sign in (demo)
        const signIn = document.getElementById('sign-in-link');
        if(signIn){
          signIn.addEventListener('click', (e) => {
            e.preventDefault();
            const html = `
              <div>
                <p style="margin-bottom:10px;">Sign in to your demo account (no backend used).</p>
                <div style="display:flex; gap:8px; margin-bottom:8px;">
                  <input id="demo-email" placeholder="your@email.com" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ddd;">
                  <input id="demo-pass" placeholder="password" type="password" style="width:140px; padding:8px; border-radius:6px; border:1px solid #ddd;">
                </div>
                <div style="display:flex; gap:8px; justify-content:flex-end;">
                  <button class="btn" id="sign-cancel">Cancel</button>
                  <button class="btn primary" id="sign-submit">Sign in</button>
                </div>
              </div>
            `;
            openSimpleModal('Sign in', html);
            setTimeout(()=> {
              document.getElementById('sign-cancel').addEventListener('click', closeSimpleModal);
              document.getElementById('sign-submit').addEventListener('click', ()=> {
                const email = document.getElementById('demo-email').value.trim();
                if(!email){ alert('Enter an email (demo)'); return; }
                signedInUser = email.split('@')[0]; // demo username
                closeSimpleModal();
                updateSignInUI();
                openSimpleModal('Signed in', `<p>Welcome, <strong>${signedInUser}</strong> — demo sign in complete.</p><div style="text-align:right;"><button class="btn" id="signed-ok">OK</button></div>`);
                setTimeout(()=>{ document.getElementById('signed-ok').addEventListener('click', closeSimpleModal); },50);
              });
            },50);
          });
        }

        // Join now (demo registration)
        const joinNow = document.getElementById('join-now-link');
        if(joinNow){
          joinNow.addEventListener('click', (e) => {
            e.preventDefault();
            const html = `
              <div>
                <p style="margin-bottom:10px;">Create a demo account and start earning demo rewards points.</p>
                <div style="display:flex; gap:8px; margin-bottom:8px;">
                  <input id="join-email" placeholder="your@email.com" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ddd;">
                </div>
                <div style="display:flex; gap:8px; justify-content:flex-end;">
                  <button class="btn" id="join-cancel">Cancel</button>
                  <button class="btn primary" id="join-submit">Join</button>
                </div>
              </div>
            `;
            openSimpleModal('Join now', html);
            setTimeout(()=> {
              document.getElementById('join-cancel').addEventListener('click', closeSimpleModal);
              document.getElementById('join-submit').addEventListener('click', ()=> {
                const email = document.getElementById('join-email').value.trim();
                if(!email){ alert('Enter an email (demo)'); return; }
                signedInUser = email.split('@')[0];
                closeSimpleModal();
                updateSignInUI();
                openSimpleModal('Welcome — Demo Member', `<p>Thanks for joining, <strong>${signedInUser}</strong>. You will earn demo points on delivered orders.</p><div style="text-align:right;"><button class="btn" id="join-ok">OK</button></div>`);
                setTimeout(()=>{ document.getElementById('join-ok').addEventListener('click', closeSimpleModal); },50);
              });
            },50);
          });
        }
      }

      function updateSignInUI(){
        const signBtn = document.getElementById('sign-in-link');
        const joinBtn = document.getElementById('join-now-link');
        if(signedInUser){
          signBtn.textContent = 'Hi, ' + (signedInUser.length > 10 ? signedInUser.slice(0,8)+'…' : signedInUser);
          joinBtn.textContent = 'Account';
          // optionally change styles to indicate signed-in state
        } else {
          signBtn.textContent = 'Sign in';
          joinBtn.textContent = 'Join now';
        }
      }

      // ---------- initialization ----------
      function init(){
        // small safety: ensure receipt path exists in array (so receipt UI doesn't break)
        // PRODUCTS addition for gift-card demo items
        if(!PRODUCTS.find(p => p.id === 'gift-500')) PRODUCTS.push({ id:'gift-500', title:'Gift Card ₹500', price:500, desc:'Demo gift card (non-redeemable).', img:'https://via.placeholder.com/320x200.png?text=GC+₹500' });
        if(!PRODUCTS.find(p => p.id === 'gift-1000')) PRODUCTS.push({ id:'gift-1000', title:'Gift Card ₹1000', price:1000, desc:'Demo gift card (non-redeemable).', img:'https://via.placeholder.com/320x200.png?text=GC+₹1000' });

        renderProducts();
        renderCart();
        updateRewardsUI();
        setupHeaderHandlers();
        updateSignInUI();

        orders.forEach(o => { if(o.orderStatus && o.orderStatus !== 'delivered' && o.orderStatus !== 'failed') startOrderProgress(o.id); });
      }

      // start
      init();

      // keyboard ESC to close
      document.addEventListener('keydown', (ev) => {
        if(ev.key === 'Escape'){ closeCart(); closePaymentModal(); closeStatusModal(); closeSimpleModal(); }
      });

    })();
  </script>
</body>
</html>